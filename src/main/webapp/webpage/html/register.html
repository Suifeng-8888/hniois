<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <title>平顶山农产品追溯-企业注册</title>

    <!-- Bootstrap -->
    <link href="../js/layui/css/layui.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/new_main.css">
    <!-- HTML5 shim 和 Respond.js 是为了让 IE8 支持 HTML5 元素和媒体查询（media queries）功能 -->
    <!-- 警告：通过 file:// 协议（就是直接将 html 页面拖拽到浏览器中）访问页面时 Respond.js 不起作用 -->
    <!--[if lt IE 9]>
    <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
    <![endif]-->
    <style type="text/css">
        .lists-mod :hover {
            border-color: #ccc;
        }
        .yellow {
            color: red;
        }
        .item_img {
            float: left;
        }
        .dropdown-menu{
            min-width: 0px;
            padding: 5px 1px;
        }
    </style>
</head>
<body>
<!-- 头部 -->
<div class="navbar ">
    <div class="container w-100">
        <div class="navbar-header ">
            <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand pad-0" href="index.html">
                <img alt="Brand" src="../imgs/logo.png">
            </a>
        </div>
        <div class="navbar-collapse collapse" role="navigation">
            <ul class="nav navbar-nav navbar-right hidden-xm">
                <li class="hidden-sm hidden-md">
                    <a href="index.html">首页</a>
                </li>
                <li>
                    <a href="company.html">企业查询</a>
                </li>
                <li>
                    <a href="product.html">产品查询</a>
                </li>
                <li>
                    <a href="consumption.html">监管巡查</a>
                </li>
                <li>
                    <a href="complain.html" >投诉建议</a>
                </li>
                <li  >
                    <a style="background-color: #1068be" class="dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                        企业备案
                        <span class="caret"></span>
                    </a>
                    <ul class="dropdown-menu" >
                        <li><a href="aprove_result.html">企业公示</a></li>
                        <li><a href="register.html">企业注册</a></li>
                    </ul>
                </li>
                <li>
                    <a href="aboutUs.html">关于我们</a>
                </li>
            </ul>
        </div>
    </div>
</div><!-- 头部end -->
<!-- banner -->
<div class="jumbotron">
    <div class="container jum-box">
        <!-- pc显示 banner字体 -->
        <h2 class="white hidden-xs">&nbsp;&nbsp;生产基地注册 &nbsp;</h2>
        <p class="white hidden-xs">&nbsp;&nbsp;&nbsp;Enterprise registration</p>
        <!-- 手机显示 banner字体 -->
        <p class="white visible-xs-block xs-text xs-text-top">来源可追查&nbsp;去向可查证</p>
        <p class="white visible-xs-block xs-text">责任可追究</p>
        <p class="white visible-xs-block xs-text ">Source can be traced traceability </p>
        <!-- end -->
        <div class="banner-greens visible-lg-block visible-md-block"></div>
    </div>
</div> <!-- banner end -->
<!--手机显示 搜索框-->
<div class="container visible-xs-block m-b-20">
    <div class="input-group">
            <span class="input-group-btn">
                <button class="btn btn-default" type="button" id="mocing_btn">
                    <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
                </button>
            </span>
        <form action="#" id="moving_code">
            <input type="text" class="form-control" placeholder="请输入17位产品追溯码">
        </form>
    </div><!-- /.row -->
</div>
<!--投诉建议form-->
<div class="content app-items app-p-t15">
    <div class="row bg">
        <div class="container" style="padding-top: 30px;">
            <form class="layui-form layui-form-pane" id="form" action="" method="post">
                <div class="form-group col-sm-6">
                    <label for="put_name"><i class="yellow">*</i>&nbsp;&nbsp;生产基地名称:</label>
                    <input id="put_name" name="p_name" autocomplete="off" type="text" class="form-control" lay-verify="required" >
                </div>
                <div class="form-group col-sm-6">
                    <label for="p_form"><em class="yellow">*</em>&nbsp;&nbsp;组织形式:</label>
                    <input id="p_form" name="p_form" type="text" autocomplete="off" class="form-control" lay-verify="required" >
                </div>
                <div class="form-group col-sm-6">
                    <label for="p_category"><em class="yellow">*</em>&nbsp;&nbsp;企业类型:</label>
                    <!--<input id="p_category" name="p_category" type="text" autocomplete="off" class="form-control" lay-verify="required" >-->
                    <select id="p_category" name="p_category">
                        <option value="">请选择</option>
                        <option value="龙头企业" >龙头企业</option>
                        <option value="家庭农场" >家庭农场</option>
                        <option value="专业合作社" >专业合作社</option>
                        <option value="其他" >其他</option>
                    </select>
                </div>
                <div class="form-group col-sm-6">
                    <label for="p_industry"><em class="yellow">*</em>&nbsp;&nbsp;所属行业:</label>
                    <!--<input id="p_industry" name="p_industry" type="text" autocomplete="off" class="form-control" lay-verify="required" >-->
                    <select id="p_industry" name="p_industry" >
                        <option value="">请选择</option>
                        <option value="种植业" >种植业</option>
                        <option value="畜禽业" >畜禽业</option>
                        <option value="水产业" >水产业</option>
                    </select>
                </div>
                <div class="form-group col-sm-6">
                    <label for="p_register"><em class="yellow">*</em>&nbsp;&nbsp;营业执照代码:</label>
                    <input id="p_register" name="p_register" autocomplete="off" type="text" class="form-control" lay-verify="required" >
                </div>
                <div class="form-group col-sm-6">
                    <label for="p_person"><em class="yellow">*</em>&nbsp;&nbsp;基地法人:</label>
                    <input id="p_person" name="p_person" autocomplete="off" type="text" class="form-control" lay-verify="required" >
                </div>
                <div class="form-group col-sm-6">
                    <label for="p_time"><em class="yellow">*</em>&nbsp;&nbsp;营业期限:</label>
                    <input type="text" name="p_time" id="p_time" lay-verify="required" placeholder="yyyy-MM-dd" autocomplete="off" class="layui-input">
                </div>
                <div class="form-group col-sm-6">
                    <label for="p_phone"><em class="yellow">*</em>&nbsp;&nbsp;联系电话:</label>
                    <input id="p_phone" name="p_phone" autocomplete="off" type="text" class="form-control" lay-verify="required" >
                </div>
                <div class="layui-form-item col-sm-12">
                    <label class="layui-form-label">所属区域:</label>
                    <div class="layui-input-inline">
                        <select name="p_province" lay-verify="required">
                            <option value="">请选择省</option>
                            <option value="河南省" selected="">河南省</option>
                        </select>
                    </div>
                    <div class="layui-input-inline">
                        <select name="p_city" lay-verify="required">
                            <option value="">请选择市</option>
                            <option value="平顶山市" selected="">平顶山市</option>
                        </select>
                    </div>
                    <div class="layui-input-inline">
                        <select name="p_area" lay-verify="required">
                            <option value="">请选择</option>
                            <option value="卫东区" >卫东区</option>
                            <option value="石龙区">石龙区</option>
                            <option value="湛河区" >湛河区</option>
                            <option value="宝丰县">宝丰县</option>
                            <option value="叶县" >叶县</option>
                            <option value="鲁山县">鲁山县</option>
                            <option value="郏县" >郏县</option>
                            <option value="舞钢市">舞钢市</option>
                            <option value="汝州市">汝州市</option>
                            <option value="新华区">新华区</option>
                            <option value="高新区">高新区</option>
                            <option value="城乡示范区">城乡示范区</option>
                        </select>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">详细地址</label>
                        <div class="layui-input-inline">
                            <input type="text" name="p_address" lay-verify="required" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                </div>
                <div class="form-group col-sm-6">
                    <label ><em class="yellow">*</em>&nbsp;&nbsp;所在地经度:</label>
                    <input  name="p_longitude" autocomplete="off" type="text" class="form-control" lay-verify="required" >
                </div>
                <div class="form-group col-sm-6">
                    <label ><em class="yellow">*</em>&nbsp;&nbsp;所在地纬度:</label>
                    <input  name="p_latitude" autocomplete="off" type="text" class="form-control" lay-verify="required" >
                </div>

                <div class="form-group col-sm-12">
                    <label for="brief"><em class="yellow">*</em>&nbsp;&nbsp;企业简介:</label>
                    <textarea id="brief" name="brief" class="form-control" rows="6"
                              autocomplete="off"   lay-verify="required" placeholder="请输入反馈内容"></textarea>
                </div>
                <div class="layui-upload col-sm-12">
                    <div class="layui-upload">
                        <input  name="p_qualifications" id="p_imgs" type="hidden"  >
                        <button type="button" class="layui-btn" id="uploadFile">企业图片资质上传</button>
                        <div id="upload_img_list"> </div>
                    </div>
                </div>
                <div class="form-group col-sm-4">
                </div>
                <div class="form-group col-sm-4">
                    <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                    <button class="btn btn-success" lay-filter="formSave" lay-submit id="form-button">提交</button>
                </div>
                <div class="form-group col-sm-4">
                </div>

            </form>
        </div>
    </div>
</div>

<footer>
    <div class="foot-info">
        Copyright © 2018  金明源农产品溯源公共信息服务平台<br  >
        <!--主办方：XXXXXXX&nbsp;|&nbsp;技术支持：XXX-->
    </div>
</footer>

<!-- jQuery (Bootstrap 的所有 JavaScript 插件都依赖 jQuery，所以必须放在前边) -->
<script src="https://cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<!-- 加载 Bootstrap 的所有 JavaScript 插件。你也可以根据需要只加载单个插件。 -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"></script>
<script src="../js/layui/layui.js"></script>
<script src="../js/layui/layui.all.js"></script>
<script src="../js/jquery-1.7.2.js"></script>
<script src="../js/config.js"></script>
<script src="../js/search.js"></script>
<script>

    //上传参数设定
    var duotu = true;//是否为多图上传true false
    var Resterurl = BaseUrl + "register/save";//保存注册信息接口
    //layui模块加载 order-2
    layui.use(['layer','upload', 'laydate','form'], function() {
        var layer = layui.layer,
            upload = layui.upload,
            laydate = layui.laydate,
            form = layui.form;

        //日期
        laydate.render({
            elem: '#p_time'
        });
        //选完文件后自动上传
        upload.render({
            elem: '#uploadFile',
            url: BaseUrl+ "/upload",
            accept:"images",
            acceptMime: 'image/*',
            multiple: duotu,
            number:8,
            done: function(res,index,upload) {
                var url = res.url[0];
                add_IMG(index,url);
            },
            allDone: function(obj){
                getQualifications();
            }
        });

        form.on("submit(formSave)", function (data) {
            $("#form").remove(".lay_img");
            subMit(Resterurl,data);
        });


    });

    /**
     * 图片拼接
     * @param idnex 图片下标
     * @param url 图片路径
     * @param cls img_old:原始图片/ img_new新增图片
     * */
    function add_IMG(index,url){
        $('#upload_img_list').append(
            '<dd class="item_img" style="width:120px;height:150px" id="img_' + index + '">' +
            '<div class="operate">' +
            '<i class="close layui-icon" onclick=delete_IMG("' + index + '","'+url+'") ></i>' +
            '</div>' +
            '<img src="'+imgPath + url + '" height="150" width="120" class="lay_img">' +
            '<input type="hidden"  name="imgs" value="' + url + '" /></dd>');
    }

    //删除图片
    function delete_IMG(divs,url) {
        $.ajax({
            url: BaseUrl+"/delete",
            data: {
                path:url, //删除路径
            },
            type: "post",
            dataType:'json',
            success: function(data){
                if(data.state=="ok"){
                    $("#img_"+divs).remove();
                    getQualifications();
                }else{
                    //错误信息
                    layer.msg(data.msg);
                }
            }
        });
    }

    function getQualifications(){
        var imgs  = "";
        $("input[name='imgs']").each(function () {
            imgs += $(this).val() + ",";
        });
        $("#p_imgs").val(imgs);
    }

    function subMit(url,data){
        $.ajax({
            url: url,
            data: data.field,
            type: 'post',
            dataType: 'json',
            success: function (result) {
                if(result.state.equal("ok")) {
                    setTimeout(function (){
                         window.location.href = "index.html";
                     },1500);
                }
                layer.msg(result.msg);
            }
        });
    }
</script>
</body>
</html>